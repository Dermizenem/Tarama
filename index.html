<!DOCTYPE html>
<html lang="tr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#2c3e50">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Likert OMR TarayÄ±cÄ±</title>
    <link rel="manifest" href="manifest.json">
    <link rel="stylesheet" href="css/style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>

<body>
    <!-- Ana Konteyner -->
    <div id="app">
        <!-- Ãœst Bar -->
        <header class="top-bar">
            <h1>ğŸ“‹ Likert OMR</h1>
            <button id="settingsBtn" class="icon-btn">âš™ï¸</button>
        </header>

        <!-- Sayfa: Kamera -->
        <section id="cameraPage" class="page active">
            <div class="camera-container">
                <video id="cameraFeed" autoplay playsinline></video>
                <canvas id="overlayCanvas"></canvas>

                <!-- A4 Tarama Ã‡erÃ§evesi -->
                <div class="scan-frame a4-frame">
                    <div class="corner top-left"></div>
                    <div class="corner top-right"></div>
                    <div class="corner bottom-left"></div>
                    <div class="corner bottom-right"></div>
                    <div class="frame-label">Formu Ã§erÃ§eveye hizalayÄ±n</div>
                </div>

                <!-- Geri SayÄ±m -->
                <div id="countdown" class="countdown hidden">
                    <span id="countdownNumber">3</span>
                </div>

                <!-- Durum MesajÄ± -->
                <div id="statusMessage" class="status-message">
                    Sistem baÅŸlatÄ±lÄ±yor...
                </div>
            </div>

            <!-- Alt Butonlar -->
            <div class="bottom-controls">
                <button id="savedFormsBtn" class="control-btn">
                    <span class="badge" id="formCount">0</span>
                    ğŸ“ Formlar
                </button>
                <button id="galleryBtn" class="control-btn">
                    ğŸ–¼ï¸ Galeri
                </button>
                <input type="file" id="galleryInput" accept="image/*" multiple hidden>
                <button id="manualCaptureBtn" class="control-btn primary">
                    ğŸ“·
                </button>
                <button id="myTemplatesBtn" class="control-btn">
                    ğŸ“‹ ÅablonlarÄ±m
                </button>
                <button id="createFormBtn" class="control-btn">
                    â• Yeni
                </button>
            </div>
        </section>

        <!-- Sayfa: Ayarlar -->
        <section id="settingsPage" class="page">
            <div class="page-header">
                <button class="back-btn" data-target="cameraPage">â† Geri</button>
                <h2>Ayarlar</h2>
            </div>

            <div class="settings-content">
                <div class="setting-group">
                    <label>Madde SayÄ±sÄ±</label>
                    <input type="number" id="itemCount" min="1" max="100" value="21">
                </div>

                <div class="setting-group">
                    <label>Likert Tipi</label>
                    <select id="likertType">
                        <option value="3">3'lÃ¼ Likert (1-3)</option>
                        <option value="5" selected>5'li Likert (1-5)</option>
                        <option value="7">7'li Likert (1-7)</option>
                    </select>
                </div>

                <div class="setting-group">
                    <label>Otomatik KayÄ±t SÃ¼resi</label>
                    <select id="autoSaveDelay">
                        <option value="3">3 Saniye</option>
                        <option value="5" selected>5 Saniye</option>
                        <option value="7">7 Saniye</option>
                        <option value="0">KapalÄ± (Manuel)</option>
                    </select>
                </div>

                <div class="setting-group">
                    <label>Puanlama YÃ¶nÃ¼</label>
                    <select id="scoreDirection">
                        <option value="low_to_high" selected>Solâ†’SaÄŸ: 1,2,3,4,5</option>
                        <option value="high_to_low">Solâ†’SaÄŸ: 5,4,3,2,1</option>
                    </select>
                </div>

                <!-- Ters Maddeler -->
                <div class="setting-group">
                    <label>Ters Puanlanan Maddeler</label>
                    <p class="setting-hint">VirgÃ¼lle ayÄ±rarak girin (Ã¶r: 3,5,7,12)</p>
                    <input type="text" id="reverseItems" placeholder="Ã–r: 3,5,7,12">
                </div>

                <button id="saveSettingsBtn" class="btn primary">ğŸ’¾ Kaydet</button>
            </div>
        </section>

        <!-- Sayfa: Kaydedilen Formlar (Tarama SonuÃ§larÄ±) -->
        <section id="savedFormsPage" class="page">
            <div class="page-header">
                <button class="back-btn" data-target="cameraPage">â† Geri</button>
                <h2>Tarama SonuÃ§larÄ±</h2>
            </div>

            <!-- GÃ¶rÃ¼nÃ¼m SeÃ§imi -->
            <div class="view-toggle">
                <button id="listViewBtn" class="btn small active">ğŸ“‹ Liste</button>
                <button id="tableViewBtn" class="btn small">ğŸ“Š Tablo</button>
            </div>

            <!-- Liste GÃ¶rÃ¼nÃ¼mÃ¼ -->
            <div id="formsList" class="forms-list">
                <!-- Formlar dinamik yÃ¼klenecek -->
            </div>

            <!-- Tablo GÃ¶rÃ¼nÃ¼mÃ¼ (SonuÃ§lar) -->
            <div id="resultsTable" class="results-table hidden">
                <!-- SonuÃ§ tablosu dinamik yÃ¼klenecek -->
            </div>

            <div class="bottom-actions">
                <button id="saveChangesBtn" class="btn primary">ğŸ’¾ Kaydet</button>
                <button id="exportExcelBtn" class="btn success">ğŸ“Š Excel'e Aktar</button>
                <button id="clearAllBtn" class="btn danger">ğŸ—‘ï¸ TÃ¼mÃ¼nÃ¼ Sil</button>
            </div>
        </section>

        <!-- Context Menu (SaÄŸ TÄ±k MenÃ¼sÃ¼) -->
        <div id="contextMenu" class="context-menu hidden">
            <button data-action="reverse">ğŸ”„ Ters Puanla</button>
            <button data-action="delete">ğŸ—‘ï¸ Sil</button>
        </div>

        <!-- Sayfa: Form ÅablonlarÄ±m -->
        <section id="templatesPage" class="page">
            <div class="page-header">
                <button class="back-btn" data-target="cameraPage">â† Geri</button>
                <h2>KayÄ±tlÄ± Form ÅablonlarÄ±m</h2>
            </div>

            <p class="page-info">OluÅŸturduÄŸunuz form ÅŸablonlarÄ±nÄ± burada gÃ¶rebilir, tarama iÃ§in seÃ§ebilir veya
                silebilirsiniz.</p>

            <div id="templatesList" class="templates-list">
                <!-- Åablonlar dinamik yÃ¼klenecek -->
            </div>

            <div class="bottom-actions">
                <button id="newTemplateBtn" class="btn primary" onclick="UI.showPage('createFormPage')">
                    â• Yeni Åablon OluÅŸtur
                </button>
            </div>
        </section>

        <!-- Sayfa: Form OluÅŸtur -->
        <section id="createFormPage" class="page">
            <div class="page-header">
                <button class="back-btn" data-target="cameraPage">â† Geri</button>
                <h2>Form OluÅŸtur</h2>
            </div>

            <div class="form-creator-content">
                <div class="setting-group">
                    <label>Ã–lÃ§ek BaÅŸlÄ±ÄŸÄ±</label>
                    <input type="text" id="formTitle" placeholder="Ã–rn: Ã–ÄŸrenme Motivasyonu Ã–lÃ§eÄŸi">
                </div>

                <div class="setting-group">
                    <label>AÃ§Ä±klama</label>
                    <textarea id="formDescription" rows="2" placeholder="YÃ¶nerge metni..."></textarea>
                </div>

                <!-- Demografik Bilgiler -->
                <div class="setting-group">
                    <div class="items-header">
                        <label>KatÄ±lÄ±mcÄ± Bilgi AlanlarÄ±</label>
                        <button id="addDemographicBtn" class="btn-small">â• Alan Ekle</button>
                    </div>
                    <p class="setting-hint">Forma eklenecek bilgi alanlarÄ±nÄ± tanÄ±mlayÄ±n (Ad Soyad, Tarih, Cinsiyet vb.)
                    </p>
                    <div id="demographicsContainer" class="demographics-container">
                        <!-- VarsayÄ±lan alanlar -->
                    </div>
                </div>

                <div class="setting-group">
                    <label>Madde SayÄ±sÄ±</label>
                    <input type="number" id="newFormItems" min="1" max="100" value="21">
                </div>

                <div class="setting-group">
                    <label>Likert Tipi</label>
                    <select id="newFormLikert">
                        <option value="3">3'lÃ¼ Likert</option>
                        <option value="5" selected>5'li Likert</option>
                        <option value="7">7'li Likert</option>
                    </select>
                </div>

                <div class="setting-group">
                    <label>Likert Etiketleri</label>
                    <div id="likertLabelsContainer" class="likert-labels">
                        <!-- Dinamik olarak doldurulacak -->
                    </div>
                </div>

                <div class="setting-group">
                    <label>Ters Puanlanan Maddeler</label>
                    <p class="setting-hint">VirgÃ¼lle ayÄ±rarak girin</p>
                    <input type="text" id="newFormReverseItems" placeholder="Ã–r: 3,5,7">
                </div>

                <!-- Madde Metinleri BÃ¶lÃ¼mÃ¼ -->
                <div class="setting-group">
                    <div class="items-header">
                        <label>Madde Metinleri</label>
                        <button id="generateItemsBtn" class="btn-small">ğŸ“ Maddeleri OluÅŸtur</button>
                    </div>
                    <p class="setting-hint">Her madde iÃ§in soru/ifade metnini girin. BoÅŸ bÄ±rakÄ±lan maddeler numaralÄ±
                        olarak gÃ¶sterilir.</p>
                    <div id="itemTextsContainer" class="item-texts-container">
                        <!-- Madde input'larÄ± dinamik olarak oluÅŸturulacak -->
                        <p class="empty-hint">YukarÄ±daki "Madde SayÄ±sÄ±"nÄ± belirleyip "ğŸ“ Maddeleri OluÅŸtur" butonuna
                            tÄ±klayÄ±n.</p>
                    </div>
                </div>

                <div class="form-actions">
                    <button id="previewFormBtn" class="btn">ğŸ‘ï¸ Ã–nizle</button>
                    <button id="generatePDFBtn" class="btn primary">ğŸ“„ PDF Ä°ndir</button>
                    <button id="generatePNGBtn" class="btn">ğŸ–¼ï¸ PNG Ä°ndir</button>
                    <button id="saveTemplateBtn" class="btn success">ğŸ’¾ Åablon Kaydet</button>
                </div>

                <div id="formPreview" class="form-preview hidden">
                    <!-- Form Ã¶nizlemesi -->
                </div>
            </div>
        </section>

        <!-- SonuÃ§ ModalÄ± -->
        <div id="resultModal" class="modal hidden">
            <div class="modal-content">
                <h3>âœ… Form Okundu</h3>
                <div id="resultDetails">
                    <p class="result-score">Toplam: <span id="totalScore">0</span></p>
                    <div id="itemScores" class="item-scores"></div>
                    <div id="errorItems" class="error-items hidden">
                        <p class="error-label">âš ï¸ Okunamayan Maddeler:</p>
                        <span id="errorItemsList"></span>
                    </div>
                </div>
                <div class="modal-actions">
                    <button id="closeResultBtn" class="btn">Tamam</button>
                </div>
            </div>
        </div>

        <!-- Galeri Ä°ÅŸleme ModalÄ± -->
        <div id="galleryProcessModal" class="modal hidden">
            <div class="modal-content wide">
                <h3>ğŸ–¼ï¸ Galeri GÃ¶rÃ¼ntÃ¼leri Ä°ÅŸleniyor</h3>
                <div id="galleryProgress">
                    <div class="progress-bar">
                        <div class="progress-fill" id="galleryProgressFill"></div>
                    </div>
                    <p id="galleryProgressText">0 / 0</p>
                </div>
                <div id="galleryResults" class="gallery-results"></div>
                <div class="modal-actions">
                    <button id="closeGalleryBtn" class="btn" disabled>Kapat</button>
                </div>
            </div>
        </div>

        <!-- YÃ¼kleniyor Overlay -->
        <div id="loadingOverlay" class="loading-overlay hidden">
            <div class="spinner"></div>
            <p>Ä°ÅŸleniyor...</p>
        </div>
    </div>

    <!-- Harici KÃ¼tÃ¼phaneler -->
    <!-- OpenCV.js -->
    <script async src="https://docs.opencv.org/4.x/opencv.js" onload="onOpenCvReady()"></script>

    <!-- SheetJS (Excel Export) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

    <!-- jsPDF (PDF OluÅŸturma) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <!-- Uygulama Scripts -->
    <script src="js/storage.js"></script>
    <script src="js/camera.js"></script>
    <script src="js/omr.js"></script>
    <script src="js/formGenerator.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/app.js"></script>
</body>

</html>